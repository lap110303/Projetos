-- 2023028420
-- A2
SELECT e.NM_ESTADO, AVG(c.QTD_DOMICILIOS) AS media_domicilios
FROM ESTADOS e
JOIN CENSO_DEMOGRAFICO c ON e.CD_AREA = c.CD_AREA_ESTADO
GROUP BY e.NM_ESTADO;
-- A0
SELECT p.NM_PAIS
FROM PAISES p
JOIN CONTINENTES c ON p.ID_CONTINENTE = c.ID
WHERE c.NM_CONTINENTE = 'AmÃ©rica do Sul';
-- A3
SELECT MUNICIPIOS.NM_MUNICIPIO, MIN(CENSO_POPULACIONAL.QTD_HABITANTES) AS MIN_QTD_HABITANTES
FROM MUNICIPIOS
JOIN CENSO_POPULACIONAL
ON MUNICIPIOS.CD_MUNICIPIO_COMPL = CENSO_POPULACIONAL.CD_MUNICIPIO_COMPL
GROUP BY MUNICIPIOS.NM_MUNICIPIO
ORDER BY MUNICIPIOS.NM_MUNICIPIO ASC;
-- A4
SELECT E.NM_ESTADO, C.NM_MUNICIPIO
FROM ESTADOS E
JOIN COVID C ON E.SIGLA = C.SIGLA_ESTADO
WHERE C.QTD_CASOS_NOVOS >= 5000
  AND C.QTD_OBITOS_NOVOS >= 50
ORDER BY E.NM_ESTADO, C.NM_MUNICIPIO;
-- A1
SELECT DISTINCT m.NM_MUNICIPIO
FROM MUNICIPIOS m
LEFT JOIN COVID d ON m.NM_MUNICIPIO = d.NM_MUNICIPIO;
-- B2
SELECT P.SIGLA, P.NM_PAIS, C.NM_CONTINENTE
FROM PAISES P
JOIN CONTINENTES C ON P.ID_CONTINENTE = C.ID
ORDER BY P.SIGLA;
-- B8
SELECT E.NM_ESTADO, COUNT(M.ID) AS QTD_MUNICIPIOS
FROM ESTADOS E
LEFT JOIN MUNICIPIOS M ON E.CD_AREA = M.CD_AREA_ESTADO
GROUP BY E.NM_ESTADO
ORDER BY E.NM_ESTADO;
-- B4
WITH dengue_totals AS (
    SELECT 
        e.NM_ESTADO,
        SUM(dg.MASCULINO) AS total_homens,
        SUM(dg.FEMININO) AS total_mulheres,
        SUM(dg.MASCULINO + dg.FEMININO) AS total
    FROM 
        DENGUE_GENERO dg
    JOIN 
        MUNICIPIOS m ON dg.CD_MUNICIPIO_COMPL = m.CD_MUNICIPIO_COMPL
    JOIN 
        ESTADOS e ON m.CD_AREA_ESTADO = e.CD_AREA
    GROUP BY 
        e.NM_ESTADO
)
SELECT 
    NM_ESTADO,
    ROUND((total_mulheres * 100.0 / total) / 100, 2) AS QTD_MULHERES_DENGUE,
    ROUND((total_homens * 100.0 / total) / 100, 2) AS QTD_HOMENS_DENGUE
FROM 
    dengue_totals
ORDER BY 
    NM_ESTADO;
-- B3
SELECT
    M.NM_MUNICIPIO,
    (SELECT SUM(G.MASCULINO)
     FROM DENGUE_GENERO G
     WHERE G.CD_MUNICIPIO_COMPL = M.CD_MUNICIPIO_COMPL
       AND G.ID = D.ID) AS DENGUE_HOMENS,
    (SELECT SUM(G.FEMININO)
     FROM DENGUE_GENERO G
     WHERE G.CD_MUNICIPIO_COMPL = M.CD_MUNICIPIO_COMPL
       AND G.ID = D.ID) AS DENGUE_MULHERES
FROM MUNICIPIOS M
JOIN DENGUE_MUNICIPIO D ON M.CD_MUNICIPIO_COMPL = D.CD_MUNICIPIO_COMPL
GROUP BY M.NM_MUNICIPIO
ORDER BY (SELECT SUM(G.MASCULINO) + SUM(G.FEMININO)
          FROM DENGUE_GENERO G
          WHERE G.CD_MUNICIPIO_COMPL = M.CD_MUNICIPIO_COMPL
            AND G.ID = D.ID) DESC
LIMIT 7;
-- B0
SELECT
    (SELECT COUNT(*) FROM MUNICIPIOS) AS QTD_MUNICIPIOS_BR,
    (SELECT COUNT(DISTINCT CD_MUNICIPIO_COMPL) - 1 FROM DENGUE_MUNICIPIO) AS QTD_DENGUE_BR,
    (SELECT COUNT(DISTINCT CD_MUNICIPIO_COMPL) - 1 FROM COVID) AS QTD_COVID_BR;
    